;;; -*- Mode: LISP; Syntax: COMMON-LISP; Package: CL-USER; Base: 10 -*-

(in-package :cl-user)

#+lispworks7
(set-default-character-element-type 'character)

;;;; ------------------------------------------------------------------
;;;; Setting for the Encoding.
;;;; ------------------------------------------------------------------
;;; To change the default encoding to UTF-8 for all file access.
(defun utf-8-file-encoding (pathname ef-spec buffer length)
  (declare (ignore pathname buffer length))
  (system:merge-ef-specs ef-spec '(:utf-8 :eol-style :lf)))

(setq system:*file-encoding-detection-algorithm*
      (substitute 'utf-8-file-encoding 'system:locale-file-encoding
                  system:*file-encoding-detection-algorithm*))

(appendf system:*file-encoding-detection-algorithm*
         '(system:detect-japanese-encoding-in-file
           system:locale-file-encoding))

(setf stream::*default-external-format* '(:utf-8 :eol-style :lf))

;;; If you want to use the encoding by UTF-8 and CRLF in the editor, uncomment the following.
;;;;   (setf (editor:variable-value "Input Format Default")
;;;;         '(:utf-8 :eol-style :crlf))
;;;;   (setf (editor:variable-value "Output Format Default")
;;;;         '(:utf-8 :eol-style :crlf))


;;;; ------------------------------------------------------------------
;;;; Loading configuration files.
;;;; ------------------------------------------------------------------
(defun load-init-file (filename &optional (conf-dir ".lwconf"))
  (load (merge-pathnames
         (make-pathname :directory `(:relative ,conf-dir)
                        :name filename)
         (user-homedir-pathname))))

#+:win32
;; to "fix" USER-HOMEDIR-PATHNAME
;; see <http://support.microsoft.com/default.aspx?scid=kb;en-us;101507>
(setf (lw:environment-variable "HOMEPATH") "\\home"
      (lw:environment-variable "HOMEDRIVE") "C:")

(change-directory (user-homedir-pathname))

;;; Apply color theme.
(load-init-file "lw-editor-color-theme\\editor-color-theme")
;; (editor-color-theme:color-theme "default")
;; (editor-color-theme:color-theme "emacs")
;; (editor-color-theme:color-theme "torte")
;; (editor-color-theme:color-theme "plain")
;; (editor-color-theme:color-theme "solarized-dark")
(editor-color-theme:color-theme "solarized-light")

;;; loading files.
(load-init-file "init")
(load-init-file "rectangle-region")
(load-init-file "bookmark")
(load-init-file "commands")
(load-init-file "keybindings")

(editor::restore-bookmark)
